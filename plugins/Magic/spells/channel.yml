channel:
  name: Channelling
  description: "You shouldn't see this..."
  icon: ender_eye{18001}
  actions:
    cast:
    - class: ChangeContext
      target_self: true
      target_caster: true
      actions:
        - class: ModifyVariable
          variable: cast_health
          value: health
        - class: Interval
          interval: 1
          duration: $warmup
          actions:
            - class: Modifier
            - class: ModifyVariable
              variable: health_change
              value: health - cast_health
            - class: CheckRequirements
              requirements:
              - variables:
                - variable: health_change
                  max: -2
              actions:
               - class: Undo
            - class: CheckTrigger
              trigger: left_click
              actions:
                - class: Undo
  effects:
    cast:
      - class: EffectSingle
        location: target
        effectlib:
           class: Modified
           duration: $warmup
           parameters:
               radius: "(t/i) * -4 + 4"
           effect:
             class: Sphere
             particles: 4
             particle_offset_x: 0.3
             particle_offset_z: 0.3
             particle_offset_y: 0.6
             offset: 0,-0.5,0
             radius: 5
             particle: dust_color_transition
             particle_size: 0.8
             color: "#73FBD3"
             to_color: "#6C2DC7"
             update_locations: true
      - class: EffectSingle
        location: target
        effectlib:
           class: Modified
           duration: $warmup
           parameters:
               radius: "0"
           effect:
             class: Sphere
             particle_increase: 0.25
             particles: 1
             particle_offset_x: 0.3
             particle_offset_z: 0.3
             particle_offset_y: 0.6
             offset: 0,-0.5,0
             speed: 1
             particle_data: 3
             particle: enchantment_table
             update_locations: true
      - sound: entity_illusioner_cast_spell
        sound_pitch: 0.1
        delay: 0
      - sound: entity_illusioner_cast_spell
        sound_pitch: 0.6
        delay: 100
      - sound: entity_illusioner_cast_spell
        sound_pitch: 1.2
        delay: 200
  parameters:
   warmup: $warmup
   target: self
   add_modifiers:
    - channelling
   remove_on_finish: true
   cancel: true

channel:
  name: Channelling
  description: "You shouldn't see this..."
  icon: tnt{18003}
  actions:
    cast:
    - class: ChangeContext
      target_self: true
      target_caster: true
      actions:
        - class: ModifyVariable
          variable: cast_health
          value: health
        - class: Interval
          interval: 1
          duration: $warmup
          actions:
            - class: ModifyVariable
              variable: power
              value: power+1
            - class: BossBar
            - class: Modifier
            - class: ModifyVariable
              variable: health_change
              value: health - cast_health
#            - class: CheckRequirements
#              requirements:
#               - wand_tags: wand
#              fail:
#               - class: Undo
            - class: CheckRequirements
              requirements:
              - variables:
                - variable: health_change
                  max: -2
              actions:
               - class: Undo
            - class: CheckTrigger
              trigger: left_click
              actions:
                - class: Retarget
                - class: PlayEffects
                  effects: inturrupt
                - class: ModifyMana
                - class: Undo
#            - class: Message
#              message: Time $power
  effects:
    cast:
      - location: target
        effectlib:
          class: EquationEffect
          xEquation: "sin(0.3141 * 0.5t)"
          yEquation: "0.5sin(0.2t)"
          zEquation: "cos(0.3141 * 0.5t)"
          duration: $warmup
          particles: 2
          particle: dust_color_transition
          particle_size: 0.8
          offset: 0,-0.5,0
          color: "#73FBD3"
          to_color: "#6C2DC7"
          cycle: true
      - location: target
        effectlib:
          class: EquationEffect
          xEquation: "-sin(0.3141 * 0.5t)"
          yEquation: "0.5sin(0.2t)"
          zEquation: "-cos(0.3141 * 0.5t)"
          duration: $warmup
          particles: 2
          particle: dust_color_transition
          particle_size: 0.8
          offset: 0,-0.5,0
          color: "#73FBD3"
          to_color: "#6C2DC7"
          cycle: true
      - location: target
        effectlib:
           class: Modified
           duration: $warmup
           parameters:
               radius: "(t/i) * -4 + 4"
           effect:
             class: Sphere
             particles: 4
             particle_offset_x: 0.3
             particle_offset_z: 0.3
             particle_offset_y: 0.6
             offset: 0,-0.5,0
             radius: 5
             particle: dust_color_transition
             particle_size: 0.8
             color: "#73FBD3"
             to_color: "#6C2DC7"
             update_locations: true
      - location: target
        effectlib:
           class: Modified
           duration: $warmup
           parameters:
               radius: "0"
           effect:
             class: Sphere
             particle_increase: 0.25
             particles: 1
             particle_offset_x: 0.3
             particle_offset_z: 0.3
             particle_offset_y: 0.6
             speed: 1
             particle_data: 3
             particle: enchantment_table
             update_locations: true
      - sound: entity_illusioner_cast_spell
        sound_pitch: 0.1
        delay: 0
      - sound: entity_illusioner_cast_spell
        sound_pitch: 0.6
        delay: 100
      - sound: entity_illusioner_cast_spell
        sound_pitch: 1.2
        delay: 200
    inturrupt:
      - location: target
        source_location: body
        particle: glow
        particle_count: 12
        particle_offset_x: 0.3
        particle_offset_z: 0.3
        particle_offset_y: 0.6
        particle_data: 0.6
  parameters:
   warmup: $warmup
   bar_style: solid
   bar_color: blue
   bar_title: "&fChannelling Spell..."
   bar_progress: $power/($warmup/50)
   bar_interval: 1
   mana: 25
   target: self
   add_modifiers:
    - channelling
   remove_on_finish: true
   cancel_on_death: true
   cancel_on_world_change: true
   cancel: true
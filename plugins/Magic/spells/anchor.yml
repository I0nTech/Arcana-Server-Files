# This is the key name of this spell
# It must be unique across the server, and is used in configs and commands such as /mage, /wand and /mgive
# to refer to this spell.
anchor:
  name: Higher Channelling
  description: "You shouldn't see this..."
  icon: ender_eye{18001}
  actions:
    cast:
    - class: ChangeContext
      target_self: true
      target_caster: true
      actions:
        - class: ModifyVariable
          variable: cast_health
          value: health
        - class: Interval
          interval: 1
          duration: $warmup
          actions:
            - class: Modifier
            - class: ModifyVariable
              variable: health_change
              value: health - cast_health
            - class: CheckRequirements
              requirements:
              - variables:
                - variable: health_change
                  max: -5
              actions:
               - class: Undo
            - class: CheckTrigger
              trigger: left_click
              actions:
                - class: Undo
  effects:
    cast:
      - location: target
        effectlib:
           class: Modified
           duration: $warmup
           parameters:
             radius: "(t/i) * -3 + 4"
           effect:
             class: Circle
             particle_count: 1
             whole_circle: false
             x_rotation: 0
             y_rotation: 30
             z_rotation: 0
             angular_velocity_x: 0
             angular_velocity_y: 0
             angular_velocity_z: 0
             offset: 0,-1.2,0
             particle: dust_color_transition
             color: "#73FBD3"
             to_color: "#6C2DC7"
             update_locations: true
             update_directions: false
             pitch: 0
             particle_data: 0.15
      - location: target
        effectlib:
           class: Modified
           duration: $warmup
           parameters:
             radius: "(t/i) * -3 + 4"
           effect:
             class: Circle
             particle_count: 1
             whole_circle: false
             x_rotation: 0
             y_rotation: -30
             z_rotation: 0
             angular_velocity_x: 0
             angular_velocity_y: 0
             angular_velocity_z: 0
             offset: 0,-1.2,0
             particle: dust_color_transition
             color: "#73FBD3"
             to_color: "#6C2DC7"
             update_locations: true
             update_directions: false
             pitch: 0
             particle_data: 0.15
      - class: EffectSingle
        location: target
        effectlib:
           class: Modified
           duration: $warmup
           parameters:
               radius: "(t/i) * -4 + 4"
           effect:
             class: Sphere
             particles: 4
             particle_offset_x: 0.3
             particle_offset_z: 0.3
             particle_offset_y: 0.6
             offset: 0,-0.5,0
             radius: 5
             particle: dust_color_transition
             particle_size: 0.8
             color: "#73FBD3"
             to_color: "#6C2DC7"
             update_locations: true
      - class: EffectSingle
        location: target
        effectlib:
           class: Modified
           duration: $warmup
           parameters:
               radius: "0"
           effect:
             class: Sphere
             particle_increase: 0.25
             particles: 1
             particle_offset_x: 0.3
             particle_offset_z: 0.3
             particle_offset_y: 0.6
             offset: 0,-0.5,0
             speed: 1
             particle_data: 3
             particle: enchantment_table
             update_locations: true
      - sound: entity_illusioner_cast_spell
        sound_pitch: 0.1
        delay: 0
      - sound: entity_illusioner_cast_spell
        sound_pitch: 0.6
        delay: 100
      - sound: entity_illusioner_cast_spell
        sound_pitch: 1.2
        delay: 200
  parameters:
   warmup: $warmup
   target: self
   add_modifiers:
    - higherchannelling
   remove_on_finish: true
   cancel: true